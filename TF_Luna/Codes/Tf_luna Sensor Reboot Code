// If the sensor is in UART mode and you are not getting readings.
// Use the below code to reset sensor (By default it switches to I2C)


#include <Wire.h>

#define TF_LUNA_ADDR 0x10  // TF-Luna 7-bit I2C address

void setup() {
  Wire.begin();             // ESP32-S3 default SDA/SCL pins
  Serial.begin(115200);
  while (!Serial) { }       // wait for Serial
  Serial.println("TF-Luna simple reader starting...");
}

void loop() {
  // 1) Point at the data registers (0x00)
  Wire.beginTransmission(TF_LUNA_ADDR);
  Wire.write(uint8_t(0x00));
  Wire.endTransmission();

  // 2) Ask for 7 bytes: dist L/H, strength L/H, temp L/H, checksum
  Wire.requestFrom(TF_LUNA_ADDR, (uint8_t)7);
  if (Wire.available() >= 6) {
    // 3) Read distance (2 bytes little-endian)
    uint16_t dist = uint16_t(Wire.read()) | (uint16_t(Wire.read()) << 8);
    // 4) Read strength (2 bytes little-endian)
    uint16_t strength = uint16_t(Wire.read()) | (uint16_t(Wire.read()) << 8);
    // 5) Skip temp and checksum
    Wire.read(); Wire.read(); Wire.read();

    // 6) Print
    Serial.print("Distance: ");
    Serial.print(dist);
    Serial.print(" mm\tStrength: ");
    Serial.println(strength);
  }

  delay(100);  // ~10 Hz update rate
}
